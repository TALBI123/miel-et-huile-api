<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="color" onchange="changeColor(this.value)" />
    <img
      src="https://raw.githubusercontent.com/AliElkhayatte1/ecommerce_miel/e21c203b78de5f7c8a293d21818c9ac0093ee281/src/assets/nv.png?token=GHSAT0AAAAAADFU56S34A73XZCCTA6HLZTW2GQCVDA"
      alt=""
    />
    <button onclick="checkOut()">Checkout</button>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
      const localUrl = "http://localhost:3000";
      const prodUrl = "https://miel-et-huile-api-production-143a.up.railway.app";
      const url = localUrl;
      const fetchData = async () => {
        const data = await fetch(`${url}/api/auth/login`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            email: "morocostudent@gmail.com",
            password: "mhayeb",
          }),
          credentials: "include",
        });
        const json = await data.json();
        console.log(json);
      };
      fetchData();
      const pk_k =
        "pk_test_51SEgCYDxHsNPCfyDeY7QoPFPX7jQWPE4tD7BhvJB0IgOoVKv3593uDkrBkTxXBXCl2xpASz23wywOy2FFc5rpimZ00r2oYaX75";
      const checkOut = async () => {
        try {
          const res = await fetch(`${url}/api/checkout`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              shippingCost: Math.floor(Math.random() * 10) + 3,
              items: [
                {
                  productId: "53d37d0e-593a-4785-9980-3030d8660ef5",
                  variantId: "d25f0a0e-06e3-4ed8-b2dc-3ff907f402ef",
                  quantity: Math.floor(Math.random() * 3) + 1,
                },
                {
                  productId: "162cf1c5-d378-4b51-baf2-827f9a39a416",
                  variantId: "ced61bb1-2ca8-4d7b-9eb7-5e80fc528df1",
                  quantity: Math.floor(Math.random() * 3) + 1,
                },
              ],
            }),
            credentials: "include",
          });
          const data = await res.json();
          console.log("Session ID:", data);
          if (data?.success === false) {
            console.error("Checkout error:", data.message);
            return;
          }
          const stripe = Stripe(pk_k);
          await stripe.redirectToCheckout({ sessionId: data.id });
        } catch (error) {
          console.error("Error during checkout:", error);
        }
      };
      // const PACKLINK_API_KEY =
      //   "50f2dd6ba10660ecd8f3df871d2bd019dfb0db45c9dc83398b98ec1ea39222bf";
      // const sandboxUrl = "https://sandbox.packlink.com/v1/services";
      // const productionUrl = "https://api.packlink.com/v1/services";
      // const url = productionUrl;
      // const testPacklink = async () => {
      //   try {
      //     const res = await fetch(url, {
      //       headers: { Authorization: `Bearer ${PACKLINK_API_KEY}` },
      //     });
      //     const data = await res.json();
      //     console.log("✅ Sandbox OK:", data);
      //   } catch (err) {
      //     console.error(
      //       "❌ Sandbox non actif:",
      //       err.response?.status,
      //       err.message
      //     );
      //   }
      // };

      // testPacklink();

      // const apiUrlProd = "https://miel-et-huile-api-production.up.railway.app";
      // const apiUrlDev = "http://localhost:3000";
      // const url = apiUrlDev;
      // const changeColor = (color) => {
      //   console.log(color);
      // };
    </script>
  </body>
</html>
