<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="color" onchange="changeColor(this.value)" />
    <img
      src="https://raw.githubusercontent.com/AliElkhayatte1/ecommerce_miel/e21c203b78de5f7c8a293d21818c9ac0093ee281/src/assets/nv.png?token=GHSAT0AAAAAADFU56S34A73XZCCTA6HLZTW2GQCVDA"
      alt=""
    />
    <button onclick="checkOut()">Checkout</button>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
      const apiUrlProd = "https://miel-et-huile-api-production.up.railway.app";
      const apiUrlDev = "http://localhost:3000";
      const url = apiUrlDev;
      const changeColor = (color) => {
        console.log(color);
      };

      const fetchData = async () => {
        // const url = "https://proactive-rebirth-production-f345.up.railway.app/login";
        const data = await fetch(`${url}/api/auth/login`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            email: "morocostudent@gmail.com",
            password: "mhayeb",
          }),
          credentials: "include",
        });
        const json = await data.json();
        console.log(json);
      };
      fetchData();
      const pk_k =
        "pk_test_51SEgCYDxHsNPCfyDeY7QoPFPX7jQWPE4tD7BhvJB0IgOoVKv3593uDkrBkTxXBXCl2xpASz23wywOy2FFc5rpimZ00r2oYaX75";
      const checkOut = async () => {
        try {
          const res = await fetch(`${url}/api/checkout`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              shippingCost: Math.floor(Math.random() * 10) + 3,
              items: [
                {
                  productId: "162cf1c5-d378-4b51-baf2-827f9a39a416",
                  variantId: "f7a66e29-a1dc-48dc-9448-3f9cad1a5927",
                  quantity: Math.floor(Math.random() * 3) + 1,
                },
                {
                  productId: "2b5bcde8-aa90-48e1-a821-c5121372c62c",
                  variantId: "535dbabc-0912-461a-b9c0-758d03ffbb12",
                  quantity: Math.floor(Math.random() * 3) + 1,
                },
              ],
            }),
            credentials: "include",
          });
          const data = await res.json();
          console.log("Session ID:", data);
          if (data?.success === false) {
            console.error("Checkout error:", data.message);
            return;
          }
          const stripe = Stripe(pk_k);
          await stripe.redirectToCheckout({ sessionId: data.id });
        } catch (error) {
          console.error("Error during checkout:", error);
        }
      };
    </script>
  </body>
</html>
